# ROADMAP_VPN — план развития VPN/Proxy проекта

## 1. Текущее состояние (MVP 0.1)

- Есть один VPN‑сервер на Fornex (Ubuntu 24.04):
  - WireGuard‑сервер `wg0` (`10.1.0.1/24`, порт `51820/UDP`).
  - Клиент Shadowsocks (`shadowsocks-libev` → `ss-redir`) c конфигом `/etc/shadowsocks-libev/ss-wg.json`, локальный порт `1081`.
  - iptables‑редирект HTTP/HTTPS для выбранных клиентов WireGuard через `ss-redir`.
- Настроены профили:
  - Владелец:
    - ПК: WireGuard‑профиль от Telegram‑бота + Windows‑клиент Shadowsocks.
    - iPhone: `client1` (от бота) + `iphone` (WireGuard через Shadowsocks).
  - Друг:
    - ПК: профиль от бота + `friend-pc`.
    - iPhone: профиль от бота + `friend-iphone`.
    - iPad: профиль от бота + `friend-ipad`.
- Есть резервная копия `wg0.conf`, `iphone.conf` и `ss-wg.json` в `/root/vpn-backups/2026-02-18/`.

## 2. Ближайшие цели (MVP 0.2)

- [x] **Документация и спеки**
  - [x] Завершить архитектурную спецификацию WireGuard+Shadowsocks (docs/specs/spec-01-architecture-wg-ss.md).
  - [x] Описать чеклист добавления нового клиента (Windows, iOS, iPadOS, Android) (docs/checklist-add-client.md).
  - [x] Описать процедуру резервного копирования и восстановления конфигов сервера (docs/backup-restore.md).

- [x] **Упрощение онбординга друзей**
  - [x] Сформировать шаблонные инструкции для клиентов:
    - [x] «Как подключиться на ПК (WireGuard + опционально Shadowsocks)» (docs/client-instructions-pc.md).
    - [x] «Как подключиться на iPhone/iPad (WireGuard)» (docs/client-instructions-ios.md).
  - [x] Условно зафиксировать нотацию имён профилей: `VPN RU`, `VPN GPT`, `Friend VPN`, `Friend VPN GPT` и т.п. (docs/profile-names.md).

- [x] **Проектная интеграция**
  - [ ] Синхронизировать эту документацию с отдельным репозиторием `nikkronos/vpnservice` (репозиторий уже используется; коммиты и push из папки `Projects/VPN/`).
  - [x] Добавить описание сервера Fornex в `docs/deployment.md` (путь, сервисы, юниты, команды проверки).

- [ ] **Улучшение совместимости сервисов**
  - [ ] **Проблема**: Сейчас VPN работает либо для одного сервиса (GPT), либо для другого (YouTube), либо для третьего (Telegram), но не для всех одновременно, как у крупных VPN‑провайдеров.
  - [ ] **Задача**: Исследовать и реализовать решение, при котором один VPN‑профиль обеспечивает одновременную работу:
    - [ ] YouTube (видео, без блокировок);
    - [ ] ChatGPT (обход блокировок);
    - [ ] Telegram (работа через VPN, без необходимости отдельного MTProto‑прокси);
    - [ ] Обычные сайты (без ограничений).
  - [ ] **Возможные направления решения**:
    - [ ] Настройка более гибкой маршрутизации (разные домены через разные пути: часть через Shadowsocks, часть напрямую);
    - [ ] Использование другого Shadowsocks‑сервера или нескольких серверов с разными IP;
    - [ ] Настройка DNS‑резолвинга для обхода блокировок на уровне DNS;
    - [ ] Исследование причин блокировок (IP‑адреса, провайдер, регион сервера).
  - [ ] **Приоритет**: Средний (не критично в данный момент, но важно для улучшения UX).

## 3. Среднесрочные цели (MVP 0.3–0.4)

- [x] **Telegram‑proxy (MTProto)**
  - [x] Выбрать и установить MTProto‑сервер на Fornex (Docker‑контейнер `telegrammessenger/proxy`).
  - [x] Настроить автозапуск через `--restart=always` в Docker.
  - [x] Сформировать и задокументировать ссылку подключения `tg://proxy?...` для друзей.
  - [x] Протестировать подключение на iOS/Android клиентах (владелец и друг).
  - [x] Описать сценарии использования в документации.

- [ ] **Второй/резервный сервер**
  - [ ] Поднять дополнительный сервер (например, EU‑локация) с WireGuard + Shadowsocks.
  - [ ] Описать стратегию переключения (DNS / смена endpoint в конфигах).
  - [ ] Подготовить процедуру миграции клиентов на второй сервер.

- [ ] **Автоматизация через бота (инструкции и интеграция)**
  - [x] Описать интеграцию с Telegram‑ботом: инструкции, MTProto, опция VPN+GPT (docs/specs/spec-03-bot-integration-instructions.md).
  - [x] Подготовить короткие тексты инструкций для бота (docs/bot-instruction-texts/): ПК, iOS, MTProto.
  - [x] Добавить пример скрипта добавления редиректа на сервере (docs/scripts/add-ss-redirect.sh.example).
  - [x] В боте: выдавать пошаговую инструкцию после /get_config и/или по команде /instruction (ПК / iOS).
  - [x] В боте: команда /proxy — отправка MTPROTO_PROXY_LINK и краткой инструкции.
  - [x] В боте (eu1): опция «VPN+GPT» при выдаче конфига — создание peer с IP из пула 10.1.0.8–254, вызов add-ss-redirect.sh на сервере по SSH.
  - [ ] На сервере eu1: развернуть add-ss-redirect.sh (см. docs/deployment.md), проверить вызов по SSH из бота.

## 4. Долгосрочные идеи

- [ ] Поддержка платных тарифов / лимитов (скорость, количество устройств).
- [ ] Логи и мониторинг:
  - [ ] Базовый мониторинг доступности серверов и сервисов (WireGuard, Shadowsocks, MTProto).
  - [ ] Ненавязчивая статистика нагрузки (без логирования персональных данных).
- [ ] Масштабирование до нескольких сотен пользователей (структура подсетей, управление ключами).

## 5. Правила обновления ROADMAP

- При **выполнении задачи**:
  - переносить короткое описание выполненного шага в `DONE_LIST_VPN.md` с датой;
  - здесь помечать задачу как `[x]`.
- При появлении новых идей:
  - добавлять их в разделы «Ближайшие» или «Среднесрочные» в виде задач, а не реализовывать сразу.

# ROADMAP_VPN

## Цели проекта

- Создать собственный VPN/Proxy сервис с упором на:
  - высокую скорость и адекватный пинг;
  - простоту подключения на Windows и iOS;
  - лёгкое восстановление при сбоях;
  - удобное управление через Telegram-бота.
- Сначала использовать для себя, друзей и коллег, затем при необходимости масштабировать до коммерческого продукта.

## Этапы развития

### Этап 0 — Подготовка

- [x] Определить название репозитория на GitHub: **`vpnservice`** (nikkronos/vpnservice).
- [x] Инициализировать отдельный Git-репозиторий в папке `VPN/` и привязать к GitHub.
- [x] Уточнить целевые регионы/провайдеров VPS:
  - **Первая нода:** существующий Timeweb-сервер (для тестирования и экономии средств);
  - **В дальнейшем:** отдельный VPS под VPN (когда будет готово и протестировано).

### Этап 1 — MVP для себя

- [x] Развернуть первую WireGuard-ноду (VPS-сервер — существующий Timeweb).
- [x] Настроить базовую конфигурацию WireGuard.
- [x] Сгенерировать конфиг/QR для владельца и протестировать:
  - [x] Windows-клиент WireGuard;
  - [x] iOS-клиент WireGuard (QR-код через qrencode).
- [x] Зафиксировать минимальные требования к скорости и пингу:
  - пинг ~10–15 мс, скорость ~91 Мбит/с вниз / ~88 Мбит/с вверх (тест на Windows).

### Этап 2 — Telegram-бот (self-service)

- [x] Создать Telegram-бота по аналогии с существующими VPN-сервисами (`@hitvpnbot`, `@barinvpn_bot`, `@avoVPN_bot`).
- [x] Реализовать команды:
  - [x] `/start` и базовая авторизация;
  - [x] `/get_config` — выдача конфигурации (через персональный `.conf`);
  - [x] `/regen` — регенерация ключа/конфига (удаление старого peer, создание нового с новыми ключами);
  - [x] `/status` — базовый статус доступа.
- [x] Связать бота с backend-логикой, управляющей WireGuard (создание peers и генерация конфигов через локальные утилиты `wg`).
- [x] Добавить поддержку нескольких пользователей (друзья, коллеги) через команды `/add_user` и `/users` (без срока окончания доступа на текущем этапе).

### Этап 3 — Надёжность и масштабирование до десятков пользователей

- [x] Добавить ещё 1–2 VPN-ноды (разные регионы/провайдеры): развёрнута нода **eu1** (Fornex, Германия, 185.21.8.91), бот создаёт пиры на eu1 по SSH.
- [x] Реализовать выбор сервера в боте (основной/запасной или список регионов) — команда `/server` с inline-кнопками для выбора между РФ и EU.
- [ ] **Проблема eu1 (Fornex):** WireGuard UDP не работает для клиентов из России (блокировка/потеря трафика на маршруте). Сервер настроен корректно, проблема вне зоны контроля. **Варианты решения:**
  - [ ] Попробовать обходные пути на Fornex (не теряя оплаченный месяц):
    - [ ] ShadowSocks на eu1 (проверка, что проблема именно в UDP WireGuard);
    - [ ] WireGuard через TCP (Nginx proxy или Cloudflared Tunnel);
    - [ ] Обфускация UDP (udp2raw, phantun).
  - [ ] Если обходные пути не помогают — миграция EU‑ноды на другой провайдер/ASN (не Fornex).
- [ ] Настроить health-check:
  - [ ] мониторинг доступности нод (ping, CPU, нагрузка);
  - [ ] уведомления в отдельный тех-бот/канал при падении ноды.
- [ ] Подготовить инструкции:
  - [ ] «Как восстановить ноду за N минут»;
  - [ ] «Как перевести пользователей на другую ноду».
#### Вопросы инфраструктуры и нагрузки

- [x] Уточнены лимиты трафика у провайдера Timeweb: **базовых ограничений по трафику нет**, главное — соблюдение правил платформы (запрет незаконного контента, DDoS, спама и т.п.).
- [ ] Оценить типичный сценарий использования (сколько людей, сколько одновременно активно пользуются).
- [ ] Оценить примерный месячный трафик на одного активного пользователя (мессенджеры, видео, игры).
- [ ] Сопоставить ожидаемую суммарную нагрузку с тарифами провайдеров VPS (скорость канала, CPU/RAM при высокой нагрузке).
- [ ] Определить порог, после которого требуется выносить VPN на отдельный сервер (или добавлять вторую ноду).
- [ ] Зафиксировать стратегию масштабирования: какие планы по увеличению канала/количества нод при росте числа пользователей.

### Этап 4 — Коммерциализация (опционально)

- [ ] Спроектировать тарифы (лимиты по времени/трафику/устройствам).
- [ ] Выбрать платёжное решение (Telegram Payments, внешние провайдеры и т.п.).
- [ ] Реализовать:
  - [ ] напоминания о продлении;
  - [ ] автоматическое продление по оплате;
  - [ ] базовую аналитику (активные подписки, нагрузка на сервера).

## Ссылки и контекст

- Общий AI roadmap: `ROAD_MAP_AI.md` (раздел про VPN/Proxy сервис).
- Общие правила и паттерны: `RULES_CURSOR.md`, `docs/AGENT_PROMPTS.md`, `docs/patterns.md`.

