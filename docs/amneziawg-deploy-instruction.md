# Развёртывание AmneziaWG на eu1 (Fornex) — пошагово

**Выбрано:** вариант A — AmneziaWG. Один клиент **AmneziaVPN** на ПК (Windows) и на iPhone/iPad. Протокол с обфускацией (трафик маскируется), подходит для обхода блокировок. Если РКН начнёт резать — в том же приложении можно добавить Xray и выдать новый конфиг; приложение менять не нужно.

**Сервер:** eu1 (Fornex), IP `185.21.8.91`, Ubuntu 24.04. Нужен SSH-доступ (логин и ключ или пароль).

---

## Что понадобится

- Доступ по SSH к серверу eu1 (логин, ключ или пароль).
- ПК с Windows (или macOS) для первого шага — установка AmneziaVPN и настройка сервера через приложение.
- В приложении AmneziaVPN установка протокола на сервер делается **автоматически** (по SSH); руками на сервере ничего ставить не нужно.

---

## Шаг 1. Установить AmneziaVPN на ПК

1. Скачать приложение: [amnezia.org — Downloads](https://amnezia.org/en/downloads) (раздел для Windows или macOS).
2. Установить и запустить AmneziaVPN.
3. Обновить до версии **не ниже 4.8.12.7** (для AmneziaWG 2.0 с обфускацией). Проверка: в приложении «О программе» или настройки.

---

## Шаг 2. Добавить сервер eu1 в приложение

1. В AmneziaVPN нажать «Добавить свой сервер» (или аналогичную кнопку).
2. Ввести данные доступа к серверу:
   - **Адрес:** `185.21.8.91` (или домен, если он привязан к этому IP).
   - **Логин SSH:** например `root` (или ваш пользователь).
   - **Пароль или ключ:** пароль от SSH или путь к файлу ключа.
3. Приложение подключится по SSH и проверит сервер. Подтвердить добавление.

---

## Шаг 3. Установить протокол AmneziaWG на сервер

1. В приложении открыть добавленный сервер (eu1).
2. Рядом с протоколом **AmneziaWG** нажать кнопку **Установить** (или значок загрузки).
3. Дождаться окончания установки (приложение сам выполнит нужные команды на сервере по SSH).
4. После установки протокол AmneziaWG будет доступен для подключения. Дополнительные настройки в большинстве случаев не нужны (подключение «из коробки»).

Официальная справка: [AmneziaWG 2.0 на своём сервере](https://docs.amnezia.org/documentation/instructions/new-amneziawg-selfhosted).

---

## Шаг 4. Создать подключение и получить конфиг для себя

1. В настройках сервера выбрать протокол **AmneziaWG**.
2. Создать подключение с полным доступом (для себя) или гостевой конфиг (для друзей).
3. Подключиться с ПК и проверить: открыть сайт в браузере, убедиться, что трафик идёт через VPN.

---

## Шаг 5. Подключиться с iPhone или iPad

1. Установить **AmneziaVPN** из App Store на iPhone/iPad.
2. Вариант А: в приложении на ПК экспортировать конфиг/ключ для AmneziaWG и отправить себе (например, по почте или мессенджеру) или показать QR-код.
3. Вариант Б: если создавали гостевой доступ — скопировать ссылку или конфиг и открыть на iPhone/iPad (установится в AmneziaVPN).
4. На iPhone/iPad открыть конфиг в AmneziaVPN и включить подключение.

Одно и то же приложение на ПК и на iOS — пользователю не нужно разбираться в протоколах: достаточно установить AmneziaVPN и вставить выданный конфиг/ссылку.

---

## Шаг 6. Тест из России

1. Подключиться к VPN с устройства в России (тот же интернет, что у целевых пользователей).
2. Проверить: браузер (заблокированные или зарубежные сайты), мессенджеры, при необходимости — стриминг, Telegram.
3. Если всё работает — зафиксировать в проекте: «AmneziaWG на eu1 работает из РФ», сохранить резервную копию конфигов (без коммита секретов в Git).

---

## Если РКН начнёт блокировать AmneziaWG

- **В том же приложении:** добавить на сервер протокол **Xray (VLESS/Reality)** через Amnezia, создать новый конфиг и раздать пользователям. Они по-прежнему открывают только AmneziaVPN.
- **Смена сервера/домена:** развернуть тот же AmneziaWG (или Xray) на другом VPS по этой инструкции и документации Amnezia; выдать новый конфиг пользователям.
- Все шаги должны быть описаны в проекте (этот файл, blocking-bypass-strategy.md, step-by-step-plan-bypass.md), чтобы перестройка не была сложной.

---

## Порты и совместимость с текущими сервисами

Установка AmneziaWG через приложение Amnezia обычно использует свои порты. Существующие сервисы на eu1 (WireGuard 51820, Shadowsocks, MTProto и т.д.) не трогаем — они работают параллельно. При необходимости проверить открытые порты в файрволе (UFW/iptables) на eu1 и при необходимости открыть порт, который укажет Amnezia (см. документацию Amnezia для self-hosted).

---

## Связанные документы

- `blocking-bypass-strategy.md` — почему выбран AmneziaWG, резерв Xray.
- `step-by-step-plan-bypass.md` — общий план обхода блокировок.
- `ROADMAP_VPN.md` — раздел «РКН: быть начеку», блок «Обход блокировок РКН».

---

*Инструкция создана 2026-02-21. Вариант A (AmneziaWG) выбран как оптимальный: один клиент на ПК и iOS, понятно пользователю, при блокировке — переход на Xray в том же приложении.*
