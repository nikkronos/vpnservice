# Стратегия обхода блокировок РКН (2026)

Документ фиксирует выбор технологий для устойчивой работы VPN в условиях блокировок (DPI, РКН). Сервер eu1 (Fornex) сохраняем; стандартный WireGuard по UDP из России не работает — нужны протоколы с обфускацией/маскировкой.

## Контекст (по данным на начало 2026)

### Что работает в РФ
- Протоколы с **обфускацией** (трафик маскируется под обычный HTTPS):
  - **VLESS (Xray) с XTLS-Reality** — маскировка под браузерный HTTPS, один из самых стабильных.
  - **WireGuard с обфускацией** — обёртки (Cloak, TLS), собственные реализации (AmneziaWG, ГусьWG, NordLynx, Lightway).
  - **OpenVPN с tls-crypt** — при нестандартных портах и обфускации.
  - **MTProxy** — для Telegram (уже используется в проекте).

### Что блокируется / устарело
- PPTP, L2TP/IPsec — фильтруются практически сразу.
- **Стандартный WireGuard и OpenVPN без маскировки** — легко детектируются и блокируются.

### Рекомендация из открытых источников
Использовать платные или собственные решения с выделенными/маскированными протоколами, которые регулярно обновляют серверы и методы обхода.

---

## Варианты для проекта (eu1 и дальнейшее развитие)

Выбраны три направления для оценки и пилота на eu1 (Fornex, 185.21.8.91).

### 2.1. AmneziaWG

**Суть:** WireGuard с обфускацией трафика (Amnezia VPN). Трафик маскируется под обычное соединение, сложнее для DPI отличить от легитимного.

**Плюсы:**
- Привычная модель «один профиль = VPN»; пользователь подключается одной кнопкой.
- Официальные клиенты: AmneziaVPN (Windows, macOS, Linux, iOS, Android).
- Открытый проект, можно развернуть свой сервер и управлять им (в т.ч. через бота при доработке).

**Минусы:**
- Нужна установка Amnezia на сервере и выдача конфигов/инструкций под Amnezia, а не классический WireGuard.
- Интеграция с текущим ботом (генерация конфигов WireGuard) потребует отдельного контура под AmneziaWG.

**Когда предпочтительно:** Нужен именно «VPN одной кнопкой» с минимальными отличиями от текущего UX, при этом обфускация WireGuard.

---

### 2.2. Amnezia с Xray

**Суть:** В экосистеме Amnezia есть не только AmneziaWG, но и возможность поднять Xray (VLESS/Reality и др.) и раздавать конфиги через приложение Amnezia.

**Плюсы:**
- Один набор клиентов (Amnezia) для разных протоколов.
- Xray/VLESS с Reality — сильная обфускация, стабильно работает в РФ по отзывам.
- Гибкость: можно предлагать и AmneziaWG, и Xray в зависимости от ситуации.

**Минусы:**
- Сложнее настройка на сервере (Xray + интеграция с Amnezia).
- Управление ключами/пользователями отличается от текущего бота на WireGuard.

**Когда предпочтительно:** Нужна максимальная устойчивость к блокировкам и готовность к чуть более сложной инфраструктуре.

---

### 2.3. Shadowrocket + Trojan (вместо VLESS)

**Суть:** На сервере поднимается **Trojan** (трафик выглядит как обычный HTTPS); клиенты подключаются через приложение Shadowrocket (iOS) или аналог на Android/Windows.

**Плюсы:**
- Trojan хорошо обходит DPI, маскировка под HTTPS.
- Shadowrocket — распространённый клиент на iOS, поддерживает Trojan, VLESS, Shadowsocks и др.
- На сервере один сервис (Trojan), конфиг проще чем полный Xray с несколькими inbound.

**Минусы:**
- Shadowrocket платный на iOS; на других платформах — другие клиенты (например, V2RayN, Clash).
- Выдача конфигов: нужен формат ссылки/конфига для Shadowrocket; бот можно доработать под отправку Trojan-ссылки вместо `.conf` WireGuard.

**Когда предпочтительно:** Фокус на iOS и готовность рекомендовать платный клиент; желание использовать Trojan вместо VLESS по соображениям простоты или стабильности.

---

### 2.4. Shadowsocks + V2BOX (совет из практики)

**Суть:** Протокол **Shadowsocks**, клиент **V2BOX**. Рекомендация: тестировать нескольких зарубежных провайдеров и менять домены, где развёрнут VPN; из 3 зарубежных в среднем 1 оказывается рабочим; выбирать **непопулярные** провайдеры/домены (меньше в фокусе блокировок). Пример упоминания: Remna Wave (непопулярный выбор).

**Плюсы:**
- Shadowsocks уже используется в проекте (ss-redir на eu1), знакомая схема.
- V2BOX — один клиент для пользователей.
- Тактика «тестировать провайдеров + непопулярные домены» снижает риск попадания под массовые блокировки.

**Минусы:**
- Нужно закладывать тестирование нескольких хостингов/доменов; 1 из 3 рабочих — норма.
- Смена домена или провайдера при блокировке требует времени и процедуры миграции.

**Когда предпочтительно:** Готовность тестировать провайдеров и при необходимости менять домен/сервер; желание использовать простой стек Shadowsocks + один клиент (V2BOX).

---

## Совет по провайдерам и доменам

- **Тестировать провайдеров:** из нескольких зарубежных VPS в среднем один стабильно работает из РФ; закладывать тесты 2–3 вариантов.
- **Менять домены:** где установлен VPN (доступ по домену или смена IP/хостинга при блокировке).
- **Выбирать непопулярные:** менее известные провайдеры и домены реже оказываются в первых волнах блокировок.

---

## Сравнение вариантов (кратко)

| Критерий              | AmneziaWG | Amnezia + Xray | Shadowrocket + Trojan | Shadowsocks + V2BOX |
|-----------------------|-----------|----------------|------------------------|----------------------|
| Обфускация            | Да        | Да (Reality)   | Да (HTTPS-like)        | Да                   |
| «Одна кнопка» VPN     | Да        | Да             | Да (в приложении)      | Да (в приложении)    |
| Клиенты               | Amnezia   | Amnezia        | Shadowrocket и др.     | V2BOX                |
| Сложность сервера     | Средняя   | Выше           | Ниже                   | Низкая (SS уже есть)|
| Тест провайдеров      | Опционально | Опционально  | Опционально            | Рекомендуется (1 из 3) |
| Интеграция с ботом    | Новый контур | Новый контур | Выдача ссылки/конфига  | Выдача конфига SS    |

---

## Выбор для проекта (зафиксировано 2026-02-21)

**Выбран вариант A (AmneziaWG).** Причины: один клиент **AmneziaVPN** на ПК (Windows) и на iPhone/iPad — не нужно разбираться в протоколах; доступно и понятно; при блокировке РКН в том же приложении можно добавить Xray и выдать новый конфиг (перестройка без смены приложения). Развёртывание: **docs/amneziawg-deploy-instruction.md**.

---

## Рекомендуемый порядок действий

1. **Задокументировать стратегию** — сделано в этом документе.
2. **Выбор для пилота** — сделан (A, AmneziaWG). Остальные варианты — на случай смены подхода:
   - **AmneziaWG** — быстрее внедрить, обфусцированный WG.
   - **Amnezia + Xray** — максимальная устойчивость.
   - **Trojan + Shadowrocket** — простота сервера, iOS.
   - **Shadowsocks + V2BOX** — простой стек, тактика «тестировать провайдеров + непопулярные домены» (см. совет выше).
3. **Пилот на eu1 (Fornex):**
   - Развернуть выбранный стек на 185.21.8.91 (параллельно с существующими WG/Shadowsocks/MTProto, на других портах).
   - Проверить подключение из России (браузер, мессенджеры, приложения).
   - Зафиксировать инструкции для пользователей и при необходимости — формат выдачи конфигов/ссылок из бота.
4. **Дальше:** интеграция с Telegram-ботом (выдача конфигов/ссылок для выбранного протокола), обновление ROADMAP и DONE_LIST.

---

## Связанные документы

- `eu1-workarounds-fornex.md` — обходные пути для eu1 (ShadowSocks, udp2raw, V2Ray).
- `vless-alternative.md` — VLESS как альтернатива WireGuard.
- `README_FOR_NEXT_AGENT.md` — текущая архитектура и ограничения eu1.
- `ROADMAP_VPN.md` — задачи по обходу блокировок и пилоту.
- **`step-by-step-plan-bypass.md`** — пошаговый план (выбрано A, от него отталкиваемся).
- **`amneziawg-deploy-instruction.md`** — пошаговая инструкция развёртывания AmneziaWG на eu1 (ПК + iOS).

---

*Документ создан 2026-02-21. Варианты 2.1–2.4 и совет по провайдерам/доменам добавлены 2026-02-21.*
