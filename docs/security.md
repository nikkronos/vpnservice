# Безопасность в проекте VPN

## Общие принципы

- Проект VPN чувствителен к безопасности и приватности:
  - через инфраструктуру проходит пользовательский трафик;
  - хранятся криптографические ключи (WireGuard);
  - есть данные о подписках и доступах пользователей.
- Все решения должны соответствовать общим правилам безопасности из:
  - `docs/security.md` (из корня репозитория);
  - `RULES_CURSOR.md`.

## Секреты и ключи

- **Никогда не коммить:**
  - приватные ключи WireGuard (серверные и клиентские);
  - файлы `.env`, `env_vars.txt` и любые другие файлы с секретами;
  - токены Telegram-бота, ключи к VPS, пароли и т.п.

- **Где хранить секреты:**
  - локально — в `env_vars.txt` (по общим правилам, см. корневую документацию);
  - на сервере — в `.env` или аналогичных конфигурационных файлах;
  - доступ к секретам должен быть только у доверенных процессов и пользователей.

## Логи и данные

- Не логировать:
  - содержимое пользовательского трафика;
  - чувствительные данные (пароли, токены, приватные ключи).

- Допустимо логировать:
  - технические метрики (нагрузка, ping, количество активных соединений);
  - обезличенную статистику (кол-во активных подписок и т.п.).

- Логи должны:
  - быть доступны для диагностики сбоев;
  - не нарушать приватность пользователей.

## Доступ к серверам

- SSH-доступ:
  - использовать ключи, а не пароли;
  - ограничить доступ по IP/файрволу, где возможно.
- На сервере:
  - использовать systemd-сервисы для автоматического перезапуска VPN и backend-сервисов;
  - регулярно обновлять систему и пакеты безопасности.

## Telegram-бот и backend

- Токен бота:
  - хранить только в `env_vars.txt` / `.env`;
  - не выводить в логи и не передавать в ответы пользователям.

- Backend:
  - валидировать все входные данные;
  - защищать административные эндпоинты (если есть панель/внутренние API);
  - использовать HTTPS/TLS для внешних API (если применимо).

## Процедуры при сбоях

- В случае компрометации ключей:
  - немедленно отозвать/регенерировать ключи на всех затронутых нодах;
  - обновить конфиги пользователей (через бота или вручную);
  - задокументировать инцидент в `SESSION_SUMMARY_YYYY-MM-DD.md` и, при необходимости, в отдельном security-отчёте.

- В случае падения ноды:
  - следовать инструкциям из `ROADMAP_VPN.md` и `SESSION_SUMMARY_...` (раздел о восстановлении и переводе пользователей);
  - обновить документацию по результату (что было сделано, какие выводы).

